# Week 12: Reverse Engineering - Dex2Jar, JD-GUI, JADX, Androguard, Obfuscation

## PART 1: 리버스 엔지니어링 개요 & 빌드 과정

### 1. 안드로이드 컴파일(빌드) 과정 ⭐ 시험 필수 암기

역공학을 하려면 "어떻게 만들어졌는지"를 거꾸로 알아야 함.

#### (1) 소스 코드 (`.java` / `.kt`)
- 개발자가 작성한 원본 파일

#### (2) 자바 바이트코드 (`.class`)
- Java Compiler (javac)가 변환함

#### (3) 달빅 바이트코드 (`.dex`)
- DEX Compiler (dx tool)가 `.class` 파일들을 모아서 변환함
- 안드로이드 가상 머신(Dalvik/ART)이 이해하는 실행 파일

#### (4) APK 파일 (`.apk`)
- `.dex` 파일과 리소스(이미지, xml 등)를 합쳐서 패키징함

---

### 3. 리버스 엔지니어링 흐름도 (구 방식)

```
APK → Unzip → classes.dex → [Dex2jar] → classes.jar → [JD-GUI] → Java Code
```

**의미**: `.dex`를 바로 읽기 힘드니까 `.jar`로 바꾸고 뷰어로 본다는 흐름

---

## PART 2: 분석 도구 비교 - Dex2Jar vs JADX

⭐ **교수님 핵심 코멘트**: "자세한 건 1, 2번 / 쓰기 편한 건 3번"

### 1. [자세한 분석용] Dex2Jar & JD-GUI

#### (1) Dex2Jar (변환기)
- `.dex` 파일을 `.jar` 파일로 변환
- **장점**: 바이트코드(Bytecode) 수준에서 **정밀하고 자세한 분석**이 가능함

#### (2) JD-GUI (뷰어)
- 변환된 `.jar` 파일을 눈으로 볼 수 있게 해줌

---

### 2. [편리한 분석용] JADX

#### (3) JADX (올인원)
- `.apk`나 `.dex`를 넣으면 바로 자바 소스코드로 보여줌
- **장점**: **쓰기 가장 편함(User-friendly)**. 가독성이 좋고 리소스도 한 번에 보여줌

---

## PART 3: JADX 주요 옵션 및 실습 명령어

### 1. JADX 도움말 및 주요 옵션

```bash
# 도움말 확인
jadx -h
```

#### [핵심 옵션]
1. **`--deobf`**: 난독화 해제 (이름 복구)
2. **`--cfg`**: 제어 흐름 그래프 저장
3. **`--log-level`**: 로그 출력 레벨 설정 (ERROR, DEBUG 등)

---

### 2. 실습 명령어 (정확한 커맨드)

#### (1) CLI 실행
```bash
jadx spacepeng.apk --log-level ERROR
```
**의미**: 터미널에서 실행하되, 자잘한 정보는 끄고 '에러(ERROR)'만 보여달라.

#### (2) GUI 실행
```bash
jadx-gui spacepeng.apk
```
**의미**: 그래픽 인터페이스(윈도우 창) 모드로 앱을 열어라.

---

## PART 4: 난독화 (Obfuscation) ⭐ 이론 중요

### 1. 난독화란?

**정의**: 코드를 읽기 어렵게 꼬아서 리버스 엔지니어링을 방해하는 기술

**목적**: 
- 앱 복제 방지
- 지적 재산권 보호
- 보안 강화

---

### 2. 난독화 기법 3가지

#### (1) Renaming (이름 변경)
- 변수/함수 이름을 a, b, c 등으로 바꿈

#### (2) Control Flow (흐름 제어)
- 실행 순서를 꼬아서 분석을 어렵게 함

#### (3) Dummy Code (더미 코드)
- 아무 기능 없는 가짜 코드를 섞음

---

## PART 5: 기타 도구 - Androguard

**특징**: 파이썬(Python)으로 만들어진 분석 도구

**장점**: 역난독화(De-obfuscation) 기능이 강력함

💡 **교수님 코멘트**: "역난독화 해주는 도구다" 정도만 알고 넘어가기

---

## PART 6: 실습 환경 - InsecureBankv2

### 1. 개요

**취약한 뱅킹 앱**: 보안 공부용으로 일부러 구멍을 뚫어놓은 앱

**구조**: 
```
안드로이드 앱 (클라이언트) <-> 파이썬 서버 (백엔드)
```

---

### 2. 설치 및 실행

#### (1) 앱 설치
- `InsecureBankNew.apk`를 에뮬레이터(Pixel 6)에 설치

#### (2) 라이브러리 설치
```bash
# 서버 폴더에서
pip3 -r requirements.txt
```

#### (3) 서버 실행
```bash
python3 app.py  # 포트 8888번으로 열림
```

---

### 3. 동작 확인

- 앱에서 서버 IP(`10.0.2.2`)와 포트(`8888`)를 입력하고 로그인 시도
- 터미널에 "Wrong Password" 같은 로그가 뜨면 연결 성공
